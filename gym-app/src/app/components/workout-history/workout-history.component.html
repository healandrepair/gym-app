<div class="workout-history">
  <div class="header">
    <h2>üìä Workout History</h2>
    <button class="btn-add-today" (click)="createTodaysWorkout()">
      ‚ûï Add Today's Workout
    </button>
  </div>

  <div *ngIf="workouts.length === 0" class="no-workouts">
    <p>No workouts recorded yet. Start your first workout to see your progress here!</p>
  </div>

  <div *ngIf="workouts.length > 0" class="history-container">
    <div class="workout-list">
      <div 
        *ngFor="let workout of workouts" 
        class="workout-card"
        [class.selected]="selectedWorkout?.id === workout.id"
        (click)="selectWorkout(workout)">
        
        <div class="workout-summary">
          <div class="workout-info">
            <h3>{{ workout.name }}</h3>
            <p class="workout-date">{{ workout.date | date:'medium' }}</p>
            <div class="workout-stats">
              <span class="stat">
                <strong>{{ workout.exercises.length }}</strong> exercises
              </span>
              <span class="stat">
                <strong>{{ getCompletedSets(workout) }}/{{ getTotalSets(workout) }}</strong> sets
              </span>
              <span class="stat">
                <strong>{{ getTotalWeight(workout) }}</strong> kg total
              </span>
            </div>
          </div>
          <div class="workout-actions">
            <button 
              class="btn-copy" 
              *ngIf="!isEditingWorkout(workout.id)"
              (click)="copyWorkout(workout); $event.stopPropagation()"
              title="Copy workout">
              üìã
            </button>
            <button 
              class="btn-rename" 
              *ngIf="!isEditingWorkout(workout.id) && !isRenamingWorkout(workout.id)"
              (click)="startRenamingWorkout(workout); $event.stopPropagation()"
              title="Rename workout">
              üè∑Ô∏è
            </button>
            <button 
              class="btn-edit" 
              *ngIf="!isEditingWorkout(workout.id)"
              (click)="startEditingWorkout(workout); $event.stopPropagation()">
              ‚úèÔ∏è
            </button>
            <button 
              class="btn-delete" 
              *ngIf="!isEditingWorkout(workout.id)"
              (click)="deleteWorkout(workout); $event.stopPropagation()">
              üóëÔ∏è
            </button>
            <div class="edit-actions" *ngIf="isEditingWorkout(workout.id)">
              <button 
                class="btn-save" 
                (click)="saveEditedWorkout(); $event.stopPropagation()">
                üíæ Save
              </button>
              <button 
                class="btn-cancel" 
                (click)="cancelEditingWorkout(); $event.stopPropagation()">
                ‚ùå Cancel
              </button>
            </div>
            <div class="rename-actions" *ngIf="isRenamingWorkout(workout.id)">
              <input 
                type="text" 
                [(ngModel)]="renameWorkoutName"
                (click)="$event.stopPropagation()"
                (keyup.enter)="saveWorkoutRename(workout)"
                (keyup.escape)="cancelWorkoutRename()"
                placeholder="Enter new name"
                class="rename-input">
              <button 
                class="btn-save" 
                (click)="saveWorkoutRename(workout); $event.stopPropagation()">
                ‚úÖ
              </button>
              <button 
                class="btn-cancel" 
                (click)="cancelWorkoutRename(); $event.stopPropagation()">
                ‚ùå
              </button>
            </div>
          </div>
        </div>

        <!-- View Mode -->
        <div *ngIf="selectedWorkout?.id === workout.id && !isEditingWorkout(workout.id)" class="workout-details">
          <div class="exercises-list">
            <div *ngFor="let workoutExercise of workout.exercises" class="exercise-detail">
              <div class="exercise-title">
                <span class="equipment-icon">{{ getEquipmentIcon(workoutExercise.exercise.equipmentType || 'other') }}</span>
                <h4>{{ workoutExercise.exercise.name }}</h4>
                <span class="equipment-type">{{ workoutExercise.exercise.equipmentType | titlecase }}</span>
              </div>
              <div class="sets-grid">
                <div class="sets-header">
                  <span>Set</span>
                  <span>Weight</span>
                  <span>Reps</span>
                  <span>Status</span>
                </div>
                <div 
                  *ngFor="let set of workoutExercise.sets; let i = index" 
                  class="set-detail"
                  [class.completed]="set.completed">
                  <span>{{ i + 1 }}</span>
                  <span>{{ set.weight }} kg</span>
                  <span>{{ set.reps }}</span>
                  <span class="status">{{ set.completed ? '‚úÖ' : '‚ùå' }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Edit Mode -->
        <div *ngIf="isEditingWorkout(workout.id)" class="workout-edit-details">
          <h3 class="edit-title">‚úèÔ∏è Editing Workout</h3>
          
          <!-- Current Exercises in Edit Mode -->
          <div class="current-exercises" *ngIf="editingWorkout && editingWorkout.exercises.length > 0">
            <h4>Current Exercises</h4>
            <div *ngFor="let workoutExercise of editingWorkout.exercises; let exerciseIndex = index" class="exercise-edit-section">
              <div class="exercise-header">
                <div class="exercise-title">
                  <span class="equipment-icon">{{ getEquipmentIcon(workoutExercise.exercise.equipmentType || 'other') }}</span>
                  <h5>{{ workoutExercise.exercise.name }}</h5>
                  <span class="equipment-type">{{ workoutExercise.exercise.equipmentType | titlecase }}</span>
                </div>
                <button class="btn-remove" (click)="removeExerciseFromEditingWorkout(exerciseIndex)">√ó</button>
              </div>

              <div class="sets-container">
                <div class="sets-header">
                  <span>Set</span>
                  <span>Weight (kg)</span>
                  <span>Reps</span>
                  <span>Done</span>
                  <span>Action</span>
                </div>

                <div *ngFor="let set of workoutExercise.sets; let setIndex = index" class="set-row">
                  <span class="set-number">{{ setIndex + 1 }}</span>
                  <input 
                    type="number" 
                    [(ngModel)]="set.weight" 
                    placeholder="0"
                    class="weight-input">
                  <input 
                    type="number" 
                    [(ngModel)]="set.reps" 
                    placeholder="0"
                    class="reps-input">
                  <input 
                    type="checkbox" 
                    [(ngModel)]="set.completed"
                    class="completed-checkbox">
                  <button class="btn-remove-set" (click)="removeSetFromExercise(exerciseIndex, setIndex)">Remove</button>
                </div>
              </div>

              <button class="btn-add-set" (click)="addSetToExercise(exerciseIndex)">+ Add Set</button>
            </div>
          </div>

          <!-- Add Exercise Section -->
          <div class="add-exercise-section">
            <h4>Add Exercise</h4>
            
            <!-- Body Part Selection -->
            <div class="body-part-selection">
              <h5>Select Body Part</h5>
              <div class="body-part-grid">
                <button 
                  *ngFor="let bodyPart of bodyParts"
                  class="body-part-btn"
                  [class.active]="selectedBodyPart === bodyPart"
                  (click)="selectBodyPart(bodyPart)">
                  {{ bodyPart }}
                </button>
              </div>
            </div>

            <!-- Equipment Type Selection -->
            <div class="equipment-selection" *ngIf="selectedBodyPart">
              <h5>Equipment Type</h5>
              <div class="equipment-grid">
                <button 
                  *ngFor="let equipmentType of equipmentTypes"
                  class="equipment-btn"
                  [class.active]="selectedEquipmentType === equipmentType"
                  (click)="selectEquipmentType(equipmentType)">
                  <span class="equipment-icon">{{ getEquipmentIcon(equipmentType) }}</span>
                  <span class="equipment-name">{{ equipmentType | titlecase }}</span>
                </button>
              </div>
              <button class="clear-filter-btn" (click)="clearFilters()">Show All Exercises</button>
            </div>

            <!-- Exercise List -->
            <div class="exercise-list" *ngIf="selectedBodyPart">
              <h5>
                Exercises 
                <span *ngIf="selectedEquipmentType">({{ selectedEquipmentType | titlecase }})</span>
              </h5>
              <div class="exercise-grid">
                <button 
                  *ngFor="let exercise of getFilteredExercises()" 
                  class="exercise-card"
                  (click)="addExerciseToEditingWorkout(exercise)">
                  <div class="exercise-header">
                    <span class="equipment-icon">{{ getEquipmentIcon(exercise.equipmentType || 'other') }}</span>
                    <div class="exercise-name">{{ exercise.name }}</div>
                  </div>
                  <div class="exercise-details">
                    <span class="exercise-category">{{ exercise.category }}</span>
                    <span class="exercise-equipment">{{ exercise.equipmentType | titlecase }}</span>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>